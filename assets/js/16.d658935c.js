(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{407:function(t,s,a){"use strict";a.r(s);var n=a(54),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"круговая-зависимость"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#круговая-зависимость"}},[t._v("#")]),t._v(" Круговая зависимость")]),t._v(" "),a("p",[t._v("Круговая зависимость возникает, когда два класса зависят друг от друга. Например, класс A нуждается в классе B, а класс\nB также нуждается в классе A. Циркулярные зависимости могут возникать в Nest между модулями и между провайдерами.")]),t._v(" "),a("p",[t._v("Хотя круговых зависимостей следует избегать по возможности, это не всегда возможно. В таких случаях Nest позволяет\nразрешать круговые зависимости между провайдерами двумя способами. В этой главе мы опишем использование "),a("strong",[t._v("прямой ссылки")]),t._v("\nкак один из способов, и использование класса "),a("strong",[t._v("ModuleRef")]),t._v(" для получения экземпляра провайдера из DI-контейнера как другой.")]),t._v(" "),a("p",[t._v("Мы также опишем разрешение круговых зависимостей между модулями.")]),t._v(" "),a("blockquote",[a("p",[t._v('При использовании файлов "barrel files (не понял как это перевести)"/index.ts для группировки импорта также может возникнуть круговая\nзависимость. Файлы barrel следует опускать, когда речь идет о классах модулей/провайдеров. Например, файлы\nbarrel не должны использоваться при импорте файлов в том же каталоге, что и файл barrel, т.е. '),a("code",[t._v("cats/cats.controller")]),t._v("\nне должен импортировать "),a("code",[t._v("cats")]),t._v(" для импорта файла "),a("code",[t._v("cats/cats.service")]),t._v(". Для получения более подробной информации смотрите\nтакже "),a("a",{attrs:{href:"https://github.com/nestjs/nest/issues/1181#issuecomment-430197191",target:"_blank",rel:"noopener noreferrer"}},[t._v("этот issue на github"),a("OutboundLink")],1),t._v(".")])]),t._v(" "),a("h2",{attrs:{id:"прямая-ссылка"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#прямая-ссылка"}},[t._v("#")]),t._v(" Прямая ссылка")]),t._v(" "),a("p",[a("strong",[t._v("Прямая ссылка")]),t._v(" позволяет Nest ссылаться на классы, которые еще не определены, используя функцию утилиты "),a("code",[t._v("forwardRef()")]),t._v(".\nНапример, если "),a("code",[t._v("CatsService")]),t._v(" и "),a("code",[t._v("CommonService")]),t._v(" зависят друг от друга, обе стороны отношений могут использовать "),a("code",[t._v("@Inject()")]),t._v("\nи утилиту "),a("code",[t._v("forwardRef()")]),t._v(" для разрешения круговой зависимости. В противном случае Nest не будет инстанцировать их, потому\nчто все необходимые метаданные будут недоступны. Вот пример:")]),t._v(" "),a("div",{staticClass:"filename"},[t._v("cats.service.ts")]),t._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token decorator"}},[a("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Injectable")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CatsService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token decorator"}},[a("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Inject")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forwardRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" CommonService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" commonService"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" CommonService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("Функция "),a("code",[t._v("forwardRef()")]),t._v(" импортируется из пакета "),a("code",[t._v("@nestjs/common")]),t._v(".")])]),t._v(" "),a("p",[t._v("Это охватывает одну сторону отношений. Теперь давайте сделаем то же самое с "),a("code",[t._v("CommonService")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token decorator"}},[a("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Injectable")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommonService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token decorator"}},[a("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Inject")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forwardRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" CatsService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" catsService"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" CatsService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("Порядок инстанцирования неопределен. Убедитесь, что ваш код не зависит от того, какой конструктор вызывается первым.")])]),t._v(" "),a("h2",{attrs:{id:"альтернатива-классу-moduleref"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#альтернатива-классу-moduleref"}},[t._v("#")]),t._v(" Альтернатива классу ModuleRef")]),t._v(" "),a("p",[t._v("Альтернативой использованию "),a("code",[t._v("forwardRef()")]),t._v(" является рефакторинг вашего кода и использование класса "),a("code",[t._v("ModuleRef")]),t._v(" для получения\nпровайдера с одной стороны круговой связи. Подробнее об утилите "),a("code",[t._v("ModuleRef")]),t._v(" "),a("a",{attrs:{href:"/guide/fundamentals/module-ref"}},[t._v("здесь")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"прямая-ссылка-на-модуль"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#прямая-ссылка-на-модуль"}},[t._v("#")]),t._v(" Прямая ссылка на модуль")]),t._v(" "),a("p",[t._v("Чтобы разрешить круговые зависимости между модулями, используйте одну и ту же служебную функцию "),a("code",[t._v("forwardRef()")]),t._v(" в обоих\nвзаимозависимых модулях. Например:")]),t._v(" "),a("div",{staticClass:"filename"},[t._v("common.module.ts")]),t._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token decorator"}},[a("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Module")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  imports"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forwardRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" CatsModule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommonModule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);